{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints related to payment operations in a backend service, including creating mock payment intents, handling mock webhooks, and simulating webhook calls. It uses FastAPI router and includes logic for processing payment events and updating order/payment statuses.", "external_files": ["src.api.config", "src.crud", "src.db.session", "src.schemas.schemas"], "external_methods": ["get_payment_webhook_secret", "crud.get_order", "crud.upsert_payment_for_order", "crud.set_order_status", "crud.get_payment_by_provider_payment_id"], "published": ["create_mock_payment_intent", "mock_payment_webhook", "simulate_mock_webhook"], "classes": [], "methods": [{"name": "Decimal _ensure_decimal(v: Decimal | None, fallback: Decimal)", "description": "Utility function to ensure a Decimal value, providing a fallback if input is None.", "scope": "", "scopeKind": ""}, {"name": "MockPaymentIntentRead create_mock_payment_intent(payload: MockPaymentIntentCreate, db: Session = Depends(get_db))", "description": "Creates a mock payment intent, persists it, and optionally updates order status. Returns payment info with a checkout URL.", "scope": "", "scopeKind": ""}, {"name": "dict mock_payment_webhook( request: Request, event: PaymentWebhookEvent, x_webhook_secret: str | None = Header(None, alias=\"X-Webhook-Secret\"), db: Session = Depends(get_db), )", "description": "Processes mock webhook events for payments, updating payment and order statuses accordingly.", "scope": "", "scopeKind": ""}, {"name": "dict simulate_mock_webhook(event: PaymentWebhookEvent)", "description": "Simulates a webhook call to the backend by posting a fake event to the webhook endpoint.", "scope": "", "scopeKind": ""}], "calls": ["crud.get_order", "crud.upsert_payment_for_order", "crud.set_order_status", "crud.get_payment_by_provider_payment_id", "get_payment_webhook_secret", "httpx.AsyncClient.post"], "search-terms": ["mock payment intent", "payment webhook", "simulate webhook", "order status update", "payment CRUD", "FastAPI payments"], "state": 2, "file_id": 19, "knowledge_revision": 43, "git_revision": "b927feaecf1ff4cdb4b968f03130bf77cf2a85a7", "ctags": [{"_type": "tag", "name": "_ensure_decimal", "path": "/home/kavia/workspace/code-generation/gourmet-express-216707-216717/food_delivery_backend/src/api/payments.py", "pattern": "/^def _ensure_decimal(v: Decimal | None, fallback: Decimal) -> Decimal:$/", "language": "Python", "typeref": "typename:Decimal", "kind": "function", "signature": "(v: Decimal | None, fallback: Decimal)"}, {"_type": "tag", "name": "create_mock_payment_intent", "path": "/home/kavia/workspace/code-generation/gourmet-express-216707-216717/food_delivery_backend/src/api/payments.py", "pattern": "/^def create_mock_payment_intent(payload: MockPaymentIntentCreate, db: Session = Depends(get_db)) /", "language": "Python", "typeref": "typename:MockPaymentIntentRead", "kind": "function", "signature": "(payload: MockPaymentIntentCreate, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "mock_payment_webhook", "path": "/home/kavia/workspace/code-generation/gourmet-express-216707-216717/food_delivery_backend/src/api/payments.py", "pattern": "/^async def mock_payment_webhook($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( request: Request, event: PaymentWebhookEvent, x_webhook_secret: str | None = Header(None, alias=\"X-Webhook-Secret\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/gourmet-express-216707-216717/food_delivery_backend/src/api/payments.py", "pattern": "/^router = APIRouter(prefix=\"\\/payments\", tags=[\"payments\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "simulate_mock_webhook", "path": "/home/kavia/workspace/code-generation/gourmet-express-216707-216717/food_delivery_backend/src/api/payments.py", "pattern": "/^async def simulate_mock_webhook(event: PaymentWebhookEvent) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(event: PaymentWebhookEvent)"}], "hash": "35780c4e1ee87e48e202fc7b41effc72", "format-version": 4, "code-base-name": "food_delivery_backend", "filename": "food_delivery_backend/src/api/payments.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/payments\", tags=[\"payments\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"43": "b927feaecf1ff4cdb4b968f03130bf77cf2a85a7"}]}